<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <!-- Google Fonts: Inter (similar to Neue Regrade) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <title>Mahesh's Photo Archive</title>

    <meta name="description" content="Mahesh's photos" />
    <meta name="theme-color" content="#9CC0CA" />
    <link rel="preload" href="./fonts/NeueRegrade-Regular.woff2" as="font" type="font/woff2" crossorigin />


    <!-- <link rel="stylesheet" href="./photo-style.css" /> -->

    <style>
        *,
        :after,
        :before {
            --tw-border-spacing-x: 0;
            --tw-border-spacing-y: 0;
            --tw-translate-x: 0;
            --tw-translate-y: 0;
            --tw-rotate: 0;
            --tw-skew-x: 0;
            --tw-skew-y: 0;
            --tw-scale-x: 1;
            --tw-scale-y: 1;
            --tw-pan-x: ;
            --tw-pan-y: ;
            --tw-pinch-zoom: ;
            --tw-scroll-snap-strictness: proximity;
            --tw-gradient-from-position: ;
            --tw-gradient-via-position: ;
            --tw-gradient-to-position: ;
            --tw-ordinal: ;
            --tw-slashed-zero: ;
            --tw-numeric-figure: ;
            --tw-numeric-spacing: ;
            --tw-numeric-fraction: ;
            --tw-ring-inset: ;
            --tw-ring-offset-width: 0px;
            --tw-ring-offset-color: #fff;
            --tw-ring-color: rgba(59, 130, 246, .5);
            --tw-ring-offset-shadow: 0 0 #0000;
            --tw-ring-shadow: 0 0 #0000;
            --tw-shadow: 0 0 #0000;
            --tw-shadow-colored: 0 0 #0000;
            --tw-blur: ;
            --tw-brightness: ;
            --tw-contrast: ;
            --tw-grayscale: ;
            --tw-hue-rotate: ;
            --tw-invert: ;
            --tw-saturate: ;
            --tw-sepia: ;
            --tw-drop-shadow: ;
            --tw-backdrop-blur: ;
            --tw-backdrop-brightness: ;
            --tw-backdrop-contrast: ;
            --tw-backdrop-grayscale: ;
            --tw-backdrop-hue-rotate: ;
            --tw-backdrop-invert: ;
            --tw-backdrop-opacity: ;
            --tw-backdrop-saturate: ;
            --tw-backdrop-sepia: ;
            --tw-contain-size: ;
            --tw-contain-layout: ;
            --tw-contain-paint: ;
            --tw-contain-style:
        }

        ::backdrop {
            --tw-border-spacing-x: 0;
            --tw-border-spacing-y: 0;
            --tw-translate-x: 0;
            --tw-translate-y: 0;
            --tw-rotate: 0;
            --tw-skew-x: 0;
            --tw-skew-y: 0;
            --tw-scale-x: 1;
            --tw-scale-y: 1;
            --tw-pan-x: ;
            --tw-pan-y: ;
            --tw-pinch-zoom: ;
            --tw-scroll-snap-strictness: proximity;
            --tw-gradient-from-position: ;
            --tw-gradient-via-position: ;
            --tw-gradient-to-position: ;
            --tw-ordinal: ;
            --tw-slashed-zero: ;
            --tw-numeric-figure: ;
            --tw-numeric-spacing: ;
            --tw-numeric-fraction: ;
            --tw-ring-inset: ;
            --tw-ring-offset-width: 0px;
            --tw-ring-offset-color: #fff;
            --tw-ring-color: rgba(59, 130, 246, .5);
            --tw-ring-offset-shadow: 0 0 #0000;
            --tw-ring-shadow: 0 0 #0000;
            --tw-shadow: 0 0 #0000;
            --tw-shadow-colored: 0 0 #0000;
            --tw-blur: ;
            --tw-brightness: ;
            --tw-contrast: ;
            --tw-grayscale: ;
            --tw-hue-rotate: ;
            --tw-invert: ;
            --tw-saturate: ;
            --tw-sepia: ;
            --tw-drop-shadow: ;
            --tw-backdrop-blur: ;
            --tw-backdrop-brightness: ;
            --tw-backdrop-contrast: ;
            --tw-backdrop-grayscale: ;
            --tw-backdrop-hue-rotate: ;
            --tw-backdrop-invert: ;
            --tw-backdrop-opacity: ;
            --tw-backdrop-saturate: ;
            --tw-backdrop-sepia: ;
            --tw-contain-size: ;
            --tw-contain-layout: ;
            --tw-contain-paint: ;
            --tw-contain-style:
        }

        /*! tailwindcss v3.4.15 | MIT License | https://tailwindcss.com*/
        *,
        :after,
        :before {
            box-sizing: border-box;
            border: 0 solid #e5e7eb
        }

        :after,
        :before {
            --tw-content: ""
        }

        :host,
        html {
            line-height: 1.5;
            -webkit-text-size-adjust: 100%;
            -moz-tab-size: 4;
            -o-tab-size: 4;
            tab-size: 4;
            font-family: ui-sans-serif, system-ui, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji;
            font-feature-settings: normal;
            font-variation-settings: normal;
            -webkit-tap-highlight-color: transparent
        }

        body {
            margin: 0;
            line-height: inherit
        }

        hr {
            height: 0;
            color: inherit;
            border-top-width: 1px
        }

        abbr:where([title]) {
            -webkit-text-decoration: underline dotted;
            text-decoration: underline dotted
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-size: inherit;
            font-weight: inherit
        }

        a {
            color: inherit;
            text-decoration: inherit
        }

        b,
        strong {
            font-weight: bolder
        }

        code,
        kbd,
        pre,
        samp {
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, Liberation Mono, Courier New, monospace;
            font-feature-settings: normal;
            font-variation-settings: normal;
            font-size: 1em
        }

        small {
            font-size: 80%
        }

        sub,
        sup {
            font-size: 75%;
            line-height: 0;
            position: relative;
            vertical-align: baseline
        }

        sub {
            bottom: -.25em
        }

        sup {
            top: -.5em
        }

        table {
            text-indent: 0;
            border-color: inherit;
            border-collapse: collapse
        }

        button,
        input,
        optgroup,
        select,
        textarea {
            font-family: inherit;
            font-feature-settings: inherit;
            font-variation-settings: inherit;
            font-size: 100%;
            font-weight: inherit;
            line-height: inherit;
            letter-spacing: inherit;
            color: inherit;
            margin: 0;
            padding: 0
        }

        button,
        select {
            text-transform: none
        }

        button,
        input:where([type=button]),
        input:where([type=reset]),
        input:where([type=submit]) {
            -webkit-appearance: button;
            background-color: transparent;
            background-image: none
        }

        :-moz-focusring {
            outline: auto
        }

        :-moz-ui-invalid {
            box-shadow: none
        }

        progress {
            vertical-align: baseline
        }

        ::-webkit-inner-spin-button,
        ::-webkit-outer-spin-button {
            height: auto
        }

        [type=search] {
            -webkit-appearance: textfield;
            outline-offset: -2px
        }

        ::-webkit-search-decoration {
            -webkit-appearance: none
        }

        ::-webkit-file-upload-button {
            -webkit-appearance: button;
            font: inherit
        }

        summary {
            display: list-item
        }

        blockquote,
        dd,
        dl,
        figure,
        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        hr,
        p,
        pre {
            margin: 0
        }

        fieldset {
            margin: 0
        }

        fieldset,
        legend {
            padding: 0
        }

        menu,
        ol,
        ul {
            list-style: none;
            margin: 0;
            padding: 0
        }

        dialog {
            padding: 0
        }

        textarea {
            resize: vertical
        }

        input::-moz-placeholder,
        textarea::-moz-placeholder {
            opacity: 1;
            color: #9ca3af
        }

        input::placeholder,
        textarea::placeholder {
            opacity: 1;
            color: #9ca3af
        }

        [role=button],
        button {
            cursor: pointer
        }

        :disabled {
            cursor: default
        }

        audio,
        canvas,
        embed,
        iframe,
        img,
        object,
        svg,
        video {
            display: block;
            vertical-align: middle
        }

        img,
        video {
            max-width: 100%;
            height: auto
        }

        [hidden]:where(:not([hidden=until-found])) {
            display: none
        }

        .fixed {
            position: fixed
        }

        .absolute {
            position: absolute
        }

        .relative {
            position: relative
        }

        .mt-3 {
            margin-top: .75rem
        }

        .mt-8 {
            margin-top: 2rem
        }

        .block {
            display: block
        }

        .inline-block {
            display: inline-block
        }

        .flex {
            display: flex
        }

        .grid {
            display: grid
        }

        .hidden {
            display: none
        }

        .max-w-xl {
            max-width: 36rem
        }

        .transform {
            transform: translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))
        }

        .items-center {
            align-items: center
        }

        .justify-between {
            justify-content: space-between
        }

        .space-x-4>:not([hidden])~:not([hidden]) {
            --tw-space-x-reverse: 0;
            margin-right: calc(1rem*var(--tw-space-x-reverse));
            margin-left: calc(1rem*(1 - var(--tw-space-x-reverse)))
        }

        .scroll-smooth {
            scroll-behavior: smooth
        }

        .border {
            border-width: 1px
        }

        .border-t {
            border-top-width: 1px
        }

        .border-dashed {
            border-style: dashed
        }

        .border-\[\#2C2C2C\] {
            --tw-border-opacity: 1;
            border-color: rgb(44 44 44/var(--tw-border-opacity, 1))
        }

        .bg-\[\#151515\] {
            --tw-bg-opacity: 1;
            background-color: rgb(21 21 21/var(--tw-bg-opacity, 1))
        }

        .p-3 {
            padding: .75rem
        }

        .px-8 {
            padding-left: 2rem;
            padding-right: 2rem
        }

        .py-10 {
            padding-top: 2.5rem;
            padding-bottom: 2.5rem
        }

        .py-8 {
            padding-top: 2rem;
            padding-bottom: 2rem
        }

        .pb-24 {
            padding-bottom: 6rem
        }

        .pb-8 {
            padding-bottom: 2rem
        }

        .text-5xl {
            font-size: 3rem;
            line-height: 1
        }

        .text-\[11px\] {
            font-size: 11px
        }

        .text-base {
            font-size: 1rem;
            line-height: 1.5rem
        }

        .text-sm {
            font-size: .875rem;
            line-height: 1.25rem
        }

        .text-xs {
            font-size: .75rem;
            line-height: 1rem
        }

        .font-bold {
            font-weight: 700
        }

        .uppercase {
            text-transform: uppercase
        }

        .leading-none {
            line-height: 1
        }

        .tracking-\[\.18em\] {
            letter-spacing: .18em
        }

        .tracking-wider {
            letter-spacing: .05em
        }

        .tracking-widest {
            letter-spacing: .1em
        }

        .text-\[\#9CC0CA\] {
            --tw-text-opacity: 1;
            color: rgb(156 192 202/var(--tw-text-opacity, 1))
        }

        .text-gray-400 {
            --tw-text-opacity: 1;
            color: rgb(156 163 175/var(--tw-text-opacity, 1))
        }

        .text-gray-500 {
            --tw-text-opacity: 1;
            color: rgb(107 114 128/var(--tw-text-opacity, 1))
        }

        .text-white {
            --tw-text-opacity: 1;
            color: rgb(255 255 255/var(--tw-text-opacity, 1))
        }

        .transition {
            transition-property: color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, -webkit-backdrop-filter;
            transition-property: color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter;
            transition-property: color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter, -webkit-backdrop-filter;
            transition-timing-function: cubic-bezier(.4, 0, .2, 1);
            transition-duration: .15s
        }

        .hover\:text-white:hover {
            --tw-text-opacity: 1;
            color: rgb(255 255 255/var(--tw-text-opacity, 1))
        }

        @media (min-width: 640px) {
            .sm\:space-x-6>:not([hidden])~:not([hidden]) {
                --tw-space-x-reverse: 0;
                margin-right: calc(1.5rem*var(--tw-space-x-reverse));
                margin-left: calc(1.5rem*(1 - var(--tw-space-x-reverse)))
            }

            .sm\:text-lg {
                font-size: 1.125rem;
                line-height: 1.75rem
            }

            .sm\:text-sm {
                font-size: .875rem;
                line-height: 1.25rem
            }
        }

        @media (min-width: 768px) {
            .md\:px-16 {
                padding-left: 4rem;
                padding-right: 4rem
            }

            .md\:text-6xl {
                font-size: 3.75rem;
                line-height: 1
            }
        }

        @media (min-width: 1024px) {
            .lg\:px-24 {
                padding-left: 6rem;
                padding-right: 6rem
            }
        }

    /* Use Google Fonts: Inter */
    /* Using Inter from Google Fonts instead of local Neue Regrade */

        body {
            font-family: 'Inter', sans-serif;
        }

        ::selection {
            background: #9CC0CA;
            color: #151515
        }

        ::-moz-selection {
            background: #9CC0CA;
            color: #151515
        }

        /* Subtle reveal */
        .fade-slide {
            opacity: 0;
            transform: translateY(16px);
            transition: opacity .6s ease, transform .6s ease
        }

        .fade-slide.show {
            opacity: 1;
            transform: translateY(0)
        }

        .underline-animate {
            position: relative;
            display: inline-block
        }

        .underline-animate::after {
            content: "";
            position: absolute;
            left: 0;
            bottom: -2px;
            height: 1px;
            width: 0;
            background: currentColor;
            transition: width .35s ease
        }

        .group:hover .underline-animate::after {
            width: 100%
        }


        .masonry {
            column-gap: 1.25rem
        }

        .masonry-item {
            break-inside: avoid;
            margin-bottom: 1.25rem
        }

        @media (min-width:640px) {
            .masonry {
                column-count: 2
            }
        }

        @media (min-width:1024px) {
            .masonry {
                column-count: 3
            }
        }

        @media (min-width:1280px) {
            .masonry {
                column-count: 4
            }
        }


        .photo-card {
            overflow: hidden;
            border: 1px solid #2C2C2C;
            border-radius: .5rem;
            background: #121212
        }

        .photo-card img {
            display: block;
            width: 100%;
            height: auto;
            transition: transform .5s ease, opacity .5s ease
        }

        .photo-card:hover img {
            transform: scale(1.015);
            opacity: .95
        }

        /* Lightbox */
        #lightbox {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, .92);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 60;
            padding: 1rem;
        }

        #lightbox.open {
            display: flex
        }

        .lb-inner {
            position: relative;
            max-width: min(95vw, 1400px);
            max-height: 85vh;
            width: 100%;
        }

        .lb-img {
            max-width: 100%;
            max-height: 80vh;
            height: auto;
            width: auto;
            object-fit: contain;
            border: 1px solid #2C2C2C;
            display: block;
            margin: 0 auto;
        }

        .lb-meta {
            margin-top: .75rem;
            color: #9CC0CA;
            text-align: center;
            font-size: .75rem;
            letter-spacing: .12em;
            text-transform: uppercase;
            padding: 0 1rem;
        }

        .lb-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 40px;
            border: 1px solid #9CC0CA;
            border-radius: 9999px;
            color: #9CC0CA;
            background: rgba(21, 21, 21, 0.8);
            display: grid;
            place-items: center;
            opacity: .85;
            transition: opacity .2s ease;
            z-index: 65;
        }

        .lb-btn:hover {
            opacity: 1;
            background: rgba(21, 21, 21, 0.95);
        }

        .lb-prev {
            left: -50px
        }

        .lb-next {
            right: -50px
        }

        .lb-close {
            top: -50px;
            right: 0;
            transform: none
        }


        @media (max-width: 768px) {
            #lightbox {
                padding: 0.5rem;
            }

            .lb-inner {
                max-width: 100vw;
                max-height: 90vh;
            }

            .lb-img {
                max-height: 70vh;
            }

            .lb-meta {
                font-size: .7rem;
                margin-top: .5rem;
                padding: 0 0.5rem;
            }

            .lb-btn {
                width: 36px;
                height: 36px;
            }

            .lb-prev {
                left: 8px;
                top: 50%;
            }

            .lb-next {
                right: 8px;
                top: 50%;
            }

            .lb-close {
                top: 8px;
                right: 8px;
            }
        }

        /* Extra small screens */
        @media (max-width: 480px) {
            .lb-inner {
                max-height: 95vh;
            }

            .lb-img {
                max-height: 65vh;
            }

            .lb-meta {
                font-size: .65rem;
            }

            .lb-btn {
                width: 32px;
                height: 32px;
            }

            .lb-btn svg {
                width: 14px;
                height: 14px;
            }
        }


        #scroll-progress {
            position: fixed;
            top: 0;
            left: 0;
            height: 2px;
            background: #9CC0CA;
            width: 0;
            z-index: 50;
            transition: width .2s ease
        }


        .skeleton {
            background: linear-gradient(90deg, #1a1a1a 25%, #2a2a2a 50%, #1a1a1a 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            border-radius: 0.5rem;
        }

        @keyframes loading {
            0% {
                background-position: 200% 0;
            }

            100% {
                background-position: -200% 0;
            }
        }


        .image-container {
            position: relative;
            overflow: hidden;
        }

        .gl-img {
            display: block;
            width: 100%;
            height: auto;
            position: relative;
            z-index: 2;
            opacity: 1;
            transition: opacity 0.3s ease;
        }


        .image-container.loading .skeleton {
            display: block;
        }

        .image-container:not(.loading) .skeleton {
            display: none;
        }

        .masonry-item {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease, transform 0.6s ease;
        }

        .masonry-item.revealed {
            opacity: 1;
            transform: translateY(0);
        }


        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #2C2C2C;
            border-top: 3px solid #9CC0CA;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 2rem auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body class="bg-[#151515] text-white">
    <div id="scroll-progress"></div>


    <header class="px-8 md:px-16 lg:px-24 py-8 flex justify-between items-center">
        <a href="/" class="text-[#9CC0CA] text-base sm:text-lg font-bold group">
            <span class="underline-animate">maheshdhingra.xyz</span>
        </a>
        <nav class="space-x-4 sm:space-x-6 text-xs sm:text-sm text-gray-400 uppercase tracking-wider">
            <a href="/" class="hover:text-white">Home</a>
            <a href="#gallery" class="hover:text-white">Gallery</a>
        </nav>
    </header>

    <section class="px-8 md:px-16 lg:px-24 pb-8">
        <h1 class="text-5xl md:text-6xl font-bold leading-none">Photo Archive</h1>
        <p class="text-sm text-gray-400 mt-3 max-w-xl">
            Occasionally i click photos as practice for the eye. Each photo is named as a song that complements its
            mood. Click to view them in a lightbox.
        </p>
    </section>

    <main id="gallery" class="px-8 md:px-16 lg:px-24 pb-24 border-t border-dashed border-[#2C2C2C]">
        <br>

        <!-- Loading indicator -->
        <div id="loadingIndicator" class="loading-spinner"></div>

        <div id="masonry" class="masonry fade-slide hidden"></div>


        <p id="emptyMsg" class="hidden text-gray-500 text-sm mt-8">
            something went wrong likely because <code>photos-data.json</code> is uh.
        </p>
    </main>


    <div id="lightbox" aria-hidden="true">
        <div class="lb-inner">
            <img id="lbImg" class="lb-img" src="" alt="">
            <div class="lb-meta" id="lbMeta"></div>

            <button class="lb-btn lb-prev" id="lbPrev" aria-label="Previous">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="#9CC0CA">
                    <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" />
                </svg>
            </button>
            <button class="lb-btn lb-next" id="lbNext" aria-label="Next">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="#9CC0CA">
                    <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6z" />
                </svg>
            </button>
            <button class="lb-btn lb-close" id="lbClose" aria-label="Close">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="#9CC0CA">
                    <path
                        d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
                </svg>
            </button>
        </div>
    </div>

    <footer
        class="px-8 md:px-16 lg:px-24 py-10 text-xs uppercase tracking-widest text-gray-400 border-t border-dashed border-[#2C2C2C]">
        © 2025 Mahesh Dhingra
    </footer>

    <script>
        window.addEventListener('scroll', () => {
            const t = window.scrollY;
            const h = document.body.scrollHeight - window.innerHeight;
            document.getElementById('scroll-progress').style.width = `${(h ? t / h : 0) * 100}%`;
        });


        const obs = new IntersectionObserver(es => {
            es.forEach(e => { if (e.isIntersecting) { e.target.classList.add('show'); obs.unobserve(e.target); } });
        }, { threshold: .1 });


        const MASONRY = document.getElementById('masonry');
        const EMPTY = document.getElementById('emptyMsg');
        const LOADING = document.getElementById('loadingIndicator');
    
    const DATA_URL = '../../../photos-data.json';


        const revealObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('revealed');
                    revealObserver.unobserve(entry.target);
                }
            });
        }, { threshold: 0.1, rootMargin: '50px' });


        function createOptimizedImage(src, alt, sizes) {
            const container = document.createElement('div');
            container.className = 'image-container loading relative';

            const img = document.createElement('img');
            img.className = 'gl-img';
            img.alt = alt || '';
            img.loading = 'lazy';
            img.decoding = 'async';
            img.sizes = sizes || '(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 25vw';


            const skeleton = document.createElement('div');
            skeleton.className = 'skeleton';

            // Handle load events
            img.onload = () => {
                container.classList.remove('loading');
            };

            img.onerror = () => {
                container.classList.remove('loading');
                img.style.display = 'none';
            };

            // Set src to start loading
            img.src = src;

            container.appendChild(skeleton);
            container.appendChild(img);

            return container;
        }

        async function loadPhotos() {
            try {
                const res = await fetch(DATA_URL, { cache: 'no-store' });
                if (!res.ok) throw new Error('Failed to load photos-data.json');
                const data = await res.json();
                const items = Array.isArray(data) ? data : (data.photos || []);
                if (!items.length) {
                    LOADING.style.display = 'none';
                    EMPTY.classList.remove('hidden');
                    return;
                }

                LOADING.style.display = 'none';
                MASONRY.classList.remove('hidden');

                const frag = document.createDocumentFragment();


                items.forEach((p, index) => {
                    const fig = document.createElement('figure');
                    fig.className = 'masonry-item photo-card gl-item';

                    // Create optimized image container
                    const imageContainer = createOptimizedImage(
                        p.src,
                        p.alt || '',
                        '(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 25vw'
                    );

                    const cap = document.createElement('figcaption');
                    cap.className = 'p-3 text-[11px] uppercase tracking-[.18em] text-gray-400';
                    cap.textContent = p.caption || '';

                    fig.appendChild(imageContainer);
                    if (p.caption) { fig.appendChild(cap); }

                    frag.appendChild(fig);
                });


                MASONRY.appendChild(frag);


                const allItems = MASONRY.querySelectorAll('.masonry-item');
                allItems.forEach((item, index) => {
                    setTimeout(() => {
                        revealObserver.observe(item);
                    }, index * 50); // Faster stagger
                });


                obs.observe(MASONRY);

                setupLightbox();
            } catch (err) {
                console.error(err);
                LOADING.style.display = 'none';
                EMPTY.textContent = 'Could not load photos-data.json';
                EMPTY.classList.remove('hidden');
            }
        }


        function setupLightbox() {
            const overlay = document.getElementById('lightbox');
            const lbImg = document.getElementById('lbImg');
            const lbMeta = document.getElementById('lbMeta');
            const prevBtn = document.getElementById('lbPrev');
            const nextBtn = document.getElementById('lbNext');
            const closeBtn = document.getElementById('lbClose');

            const items = Array.from(document.querySelectorAll('.gl-item .gl-img'));
            if (!items.length) return;

            let idx = 0;

            function preloadImage(src) {
                return new Promise((resolve, reject) => {
                    const img = new Image();
                    img.onload = () => resolve(img);
                    img.onerror = reject;
                    img.src = src;
                });
            }

            async function open(i) {
                idx = i;
                const img = items[idx];

                // Show image immediately, no blur effect
                lbImg.src = img.src;
                lbImg.alt = img.alt || '';

                const cap = img.closest('figure').querySelector('figcaption');
                lbMeta.textContent = cap ? cap.textContent.trim() : '';

                overlay.classList.add('open');
                overlay.setAttribute('aria-hidden', 'false');
                document.body.style.overflow = 'hidden';

                // Preload adjacent images in background
                const nextIdx = (idx + 1) % items.length;
                const prevIdx = (idx - 1 + items.length) % items.length;
                preloadImage(items[nextIdx].src).catch(() => { });
                preloadImage(items[prevIdx].src).catch(() => { });
            }

            function close() {
                overlay.classList.remove('open');
                overlay.setAttribute('aria-hidden', 'true');
                document.body.style.overflow = '';
                lbImg.src = '';
            }
            function next() { open((idx + 1) % items.length); }
            function prev() { open((idx - 1 + items.length) % items.length); }

            items.forEach((img, i) => {
                img.style.cursor = 'zoom-in';
                img.addEventListener('click', () => open(i));
            });

            overlay.addEventListener('click', (e) => { if (e.target === overlay) close(); });
            closeBtn.addEventListener('click', close);
            nextBtn.addEventListener('click', next);
            prevBtn.addEventListener('click', prev);

            window.addEventListener('keydown', e => {
                if (!overlay.classList.contains('open')) return;
                if (e.key === 'Escape') close();
                else if (e.key === 'ArrowRight') next();
                else if (e.key === 'ArrowLeft') prev();
            });
        }

        // Start loading immediately
        loadPhotos();
    </script>
</body>

</html>